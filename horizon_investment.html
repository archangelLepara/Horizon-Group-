<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horizon Investment Consultants</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Firebase compat scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore-compat.js"></script>

  <style>
    /* BEGIN BASIC CSS */
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; }
    .header { background: #1e2a78; color: #fff; padding: 20px; text-align: center; }
    .section { padding: 20px; }
    .service-card { background: #fff; padding: 15px; margin: 10px 0; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    button { background: #1e2a78; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px 0;}
    button:hover { background: #3b49c3; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px;}
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center;}
    input { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    form { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
  </style>
</head>
<body>

  <header class="header">
    <h1>Horizon Investment Consultants</h1>
    <p>Expert Guidance. Smart Decisions. Sustainable Growth.</p>
  </header>

  <!-- Services Section -->
  <section class="section services">
    <div class="service-card">
      <h2>Introduction to Stocks</h2>
      <p>Learn the basics of stock investing. <strong>Page under construction â€“ Available Soon!</strong></p>
    </div>
    <div class="service-card">
      <h2>MSE Portfolio Tracker</h2>
      <p>Manage your stock portfolio with Google login.</p>
      <button id="loginBtn">Login with Google</button>
      <button id="logoutBtn" style="display:none;">Logout</button>
    </div>
  </section>

  <!-- Portfolio Tracker Section -->
  <section class="section" id="portfolioSection" style="display:none;">
    <form id="stockForm">
      <h2>Add New Stock</h2>
      <input type="text" id="company" placeholder="Company Name" required>
      <input type="date" id="dateBought" required>
      <input type="number" id="quantity" placeholder="Quantity" min="1" required>
      <input type="number" id="price" placeholder="Price per Share" step="0.01" min="0" required>
      <button type="submit">Add Stock</button>
    </form>

    <h2>Your Portfolio</h2>
    <table id="portfolioTable">
      <thead>
        <tr>
          <th>Company</th>
          <th>Date Bought</th>
          <th>Quantity</th>
          <th>Price per Share</th>
          <th>Total Value</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Portfolio Performance</h2>
    <canvas id="portfolioChart" width="400" height="200"></canvas>
  </section>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCZtiRNOjxM875GzxcDB_cUROyVScH_OHA",
      authDomain: "horizon-investments.firebaseapp.com",
      projectId: "horizon-investments",
      storageBucket: "horizon-investments.firebasestorage.app",
      messagingSenderId: "453178632734",
      appId: "1:453178632734:web:e4e062c1a7a13829485c0f",
      measurementId: "G-GQWQ400WBH"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const portfolioSection = document.getElementById("portfolioSection");
    const stockForm = document.getElementById("stockForm");
    const portfolioTableBody = document.querySelector("#portfolioTable tbody");
    const portfolioChartCanvas = document.getElementById("portfolioChart").getContext("2d");

    let user = null;
    let chart = null;

    // Google Login
    loginBtn.addEventListener("click", () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(result => {
        user = result.user;
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        portfolioSection.style.display = "block";
        loadPortfolio();
      }).catch(err => alert(err.message));
    });

    // Logout
    logoutBtn.addEventListener("click", () => {
      auth.signOut().then(() => {
        user = null;
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        portfolioSection.style.display = "none";
      });
    });

    // Auth state change
    auth.onAuthStateChanged(u => {
      if(u){
        user = u;
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        portfolioSection.style.display = "block";
        loadPortfolio();
      }
    });

    // Add stock
    stockForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const stock = {
        company: document.getElementById("company").value,
        dateBought: document.getElementById("dateBought").value,
        quantity: parseInt(document.getElementById("quantity").value),
        price: parseFloat(document.getElementById("price").value),
        uid: user.uid
      };
      await db.collection("portfolios").add(stock);
      stockForm.reset();
      loadPortfolio();
    });

    // Load portfolio
    async function loadPortfolio() {
      const snapshot = await db.collection("portfolios").where("uid", "==", user.uid).get();
      const stocks = snapshot.docs.map(doc => doc.data());

      // Populate table
      portfolioTableBody.innerHTML = "";
      stocks.forEach(stock => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${stock.company}</td>
          <td>${stock.dateBought}</td>
          <td>${stock.quantity}</td>
          <td>${stock.price.toFixed(2)}</td>
          <td>${(stock.quantity * stock.price).toFixed(2)}</td>
        `;
        portfolioTableBody.appendChild(row);
      });

      // Draw chart
      const labels = stocks.map(s => s.company);
      const data = stocks.map(s => s.quantity * s.price);

      if (chart) chart.destroy();
      chart = new Chart(portfolioChartCanvas, {
        type: "bar",
        data: { labels, datasets: [{ label: "Total Value", data, backgroundColor: "#4caf50" }] },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
    }
  </script>
</body>
</html>